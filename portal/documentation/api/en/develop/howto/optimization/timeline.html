<div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
<div itemprop="articleBody">
<div class="section" id="how-to-use-timeline-tool-to-do-profile">
<span id="how-to-use-timeline-tool-to-do-profile"></span><h1>how to use timeline tool to do profile<a class="headerlink" href="#how-to-use-timeline-tool-to-do-profile" title="永久链接至标题">¶</a></h1>
<ol>
<li><p class="first">Add <code class="docutils literal"><span class="pre">with</span> <span class="pre">profiler.profiler(...)</span></code> to the main training loop. After run, the code will generate a profile record file <code class="docutils literal"><span class="pre">/tmp/profile</span></code>. <strong>Warning</strong>: Please do not run too many batches when use profiler to record timeline information, for the profile record will grow with the batch number.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">profiler</span><span class="o">.</span><span class="n">profiler</span><span class="p">(</span><span class="s1">'All'</span><span class="p">,</span> <span class="s1">'total'</span><span class="p">,</span> <span class="s1">'/tmp/profile'</span><span class="p">)</span> <span class="k">as</span> <span class="n">prof</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">pass_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pass_num</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">batch_id</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">train_reader</span><span class="p">()):</span>
            <span class="n">exe</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fluid</span><span class="o">.</span><span class="n">default_main_program</span><span class="p">(),</span>
                    <span class="n">feed</span><span class="o">=</span><span class="n">feeder</span><span class="o">.</span><span class="n">feed</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
                    <span class="n">fetch_list</span><span class="o">=</span><span class="p">[],</span>
                    <span class="n">use_program_cache</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="o">...</span>
</pre></div>
</div>
</li>
<li><p class="first">Run <code class="docutils literal"><span class="pre">python</span> <span class="pre">paddle/tools/timeline.py</span></code> to process <code class="docutils literal"><span class="pre">/tmp/profile</span></code>, it will generate another
file <code class="docutils literal"><span class="pre">/tmp/timeline</span></code> by default. You can change the path by cmd parameter, please take a look at
<a class="reference external" href="https://github.com/PaddlePaddle/Paddle/blob/develop/tools/timeline.py">timeline.py</a> for details.</p>
</li>
<li><p class="first">Open chrome and visit <a class="reference external" href="chrome://tracing/">chrome://tracing/</a>, use <code class="docutils literal"><span class="pre">load</span></code> button to load the generated <code class="docutils literal"><span class="pre">timeline</span></code> file.</p>
<p><img alt="chrome tracing" src="../../_images/tracing.jpeg"/></p>
</li>
<li><p class="first">The resulting timeline should be like:</p>
</li>
</ol>
<div class="highlight-default"><div class="highlight"><pre><span></span>![chrome timeline](./timeline.jpeg)
</pre></div>
</div>
</div>
</div>
<div class="articleComments">
</div>
</div>