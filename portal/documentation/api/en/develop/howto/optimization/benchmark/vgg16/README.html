<div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
<div itemprop="articleBody">
<div class="section" id="performance-for-distributed-vgg16">
<span id="performance-for-distributed-vgg16"></span><h1>Performance for Distributed vgg16<a class="headerlink" href="#performance-for-distributed-vgg16" title="永久链接至标题">¶</a></h1>
<div class="section" id="test-result">
<span id="test-result"></span><h2>Test Result<a class="headerlink" href="#test-result" title="永久链接至标题">¶</a></h2>
<div class="section" id="hardware-infomation">
<span id="hardware-infomation"></span><h3>Hardware Infomation<a class="headerlink" href="#hardware-infomation" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>CPU: Intel(R) Xeon(R) CPU E5-2620 v4 @ 2.10GHz</li>
<li>cpu MHz       : 2101.000</li>
<li>cache size    : 20480 KB</li>
</ul>
</div>
<div class="section" id="blas-settings">
<span id="blas-settings"></span><h3>Blas settings<a class="headerlink" href="#blas-settings" title="永久链接至标题">¶</a></h3>
<p>Setting environment variable: <code class="docutils literal"><span class="pre">MKL_NUM_THREADS=1</span></code>.</p>
</div>
<div class="section" id="single-node-single-thread">
<span id="single-node-single-thread"></span><h3>Single Node Single Thread<a class="headerlink" href="#single-node-single-thread" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>Metrics: samples / sec</li>
</ul>
<table>
<thead>
<tr>
<th>Batch Size </th>
<th> 32</th>
<th>64</th>
<th>128 </th>
<th>256</th>
</tr>
</thead>
<tbody>
<tr>
<td> PaddlePaddle Fluid</td>
<td> 15.44 </td>
<td> 16.32 </td>
<td> 16.74 </td>
<td> 16.79 </td>
</tr>
<tr>
<td>PaddlePaddle v2  </td>
<td> 15.97 </td>
<td> 17.04 </td>
<td> 17.60 </td>
<td> 17.83 </td>
</tr>
<tr>
<td>TensorFlow </td>
<td> 9.09 </td>
<td> 9.10 </td>
<td> 9.24 </td>
<td> 8.66 </td>
</tr>
</tbody>
</table></div>
<div class="section" id="different-batch-size">
<span id="different-batch-size"></span><h3>Different Batch Size<a class="headerlink" href="#different-batch-size" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>PServer Count: 10</li>
<li>Trainer Count: 20</li>
<li>Metrics: samples / sec</li>
</ul>
<table>
<thead>
<tr>
<th>Batch Size </th>
<th> 32</th>
<th>64</th>
<th>128 </th>
<th>256</th>
</tr>
</thead>
<tbody>
<tr>
<td> PaddlePaddle Fluid</td>
<td> 190.20 </td>
<td> 222.15 </td>
<td> 247.40 </td>
<td> 258.18 </td>
</tr>
<tr>
<td>PaddlePaddle v2  </td>
<td> 170.96 </td>
<td> 233.71 </td>
<td> 256.14 </td>
<td> 329.23 </td>
</tr>
<tr>
<td>TensorFlow </td>
<td> - </td>
<td> - </td>
<td> - </td>
<td> - </td>
</tr>
</tbody>
</table></div>
<div class="section" id="accelerate-rate">
<span id="accelerate-rate"></span><h3>Accelerate Rate<a class="headerlink" href="#accelerate-rate" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>Pserver Count: 20</li>
<li>Batch Size: 128</li>
<li>Metrics: samples / sec</li>
</ul>
<table>
<thead>
<tr>
<th>Trainer Count </th>
<th>20</th>
<th>40</th>
<th>80</th>
<th>100</th>
</tr>
</thead>
<tbody>
<tr>
<td> PaddlePaddle Fluid</td>
<td> 263.29 (78.64%) </td>
<td> 518.80 (77.47%) </td>
<td> 836.26 (62.44%) </td>
<td> 1019.29 (60.89%) </td>
</tr>
<tr>
<td>PaddlePaddle v2 (need more tests)   </td>
<td> 326.85 (92.85%) </td>
<td> 534.58 (75.93%) </td>
<td> 853.30 (60.60%) </td>
<td> 1041.99 (59.20%) </td>
</tr>
<tr>
<td>TensorFlow </td>
<td> - </td>
<td> - </td>
<td> - </td>
<td> - </td>
</tr>
</tbody>
</table></div>
<div class="section" id="different-pserver-count">
<span id="different-pserver-count"></span><h3>Different Pserver Count<a class="headerlink" href="#different-pserver-count" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>Trainer Count: 60</li>
<li>Batch Size: 128</li>
<li>Metrics: samples/ sec</li>
</ul>
<table>
<thead>
<tr>
<th>PServer Count </th>
<th>3</th>
<th>6</th>
<th>10</th>
<th>20</th>
</tr>
</thead>
<tbody>
<tr>
<td> PaddlePaddle Fluid(should fix in next PR) </td>
<td> 589.1 </td>
<td> 592.6 </td>
<td> 656.4 </td>
<td> 655.8 </td>
</tr>
<tr>
<td>PaddlePaddle v2 (need more tests)   </td>
<td> 593.4 </td>
<td> 791.3 </td>
<td> 729.7 </td>
<td> 821.7 </td>
</tr>
<tr>
<td>TensorFlow </td>
<td> - </td>
<td> - </td>
<td> - </td>
<td> - </td>
</tr>
</tbody>
</table><p><em>The performance gap between Fuild and v2 comes from the network interference.</em></p>
</div>
</div>
<div class="section" id="steps-to-run-the-performance-test">
<span id="steps-to-run-the-performance-test"></span><h2>Steps to Run the Performance Test<a class="headerlink" href="#steps-to-run-the-performance-test" title="永久链接至标题">¶</a></h2>
<ol class="simple">
<li>You must re-compile PaddlePaddle and enable <code class="docutils literal"><span class="pre">-DWITH_DISTRIBUTE</span></code> to build PaddlePaddle with distributed support.</li>
<li>When the build finishes, copy the output <code class="docutils literal"><span class="pre">whl</span></code> package located under <code class="docutils literal"><span class="pre">build/python/dist</span></code> to current directory.</li>
<li>Run <code class="docutils literal"><span class="pre">docker</span> <span class="pre">build</span> <span class="pre">-t</span> <span class="pre">[image:tag]</span> <span class="pre">.</span></code> to build the docker image and run <code class="docutils literal"><span class="pre">docker</span> <span class="pre">push</span> <span class="pre">[image:tag]</span></code> to push the image to reponsitory so kubernetes can find it.</li>
<li>Run <code class="docutils literal"><span class="pre">kubectl</span> <span class="pre">create</span> <span class="pre">-f</span> <span class="pre">pserver.yaml</span> <span class="pre">&amp;&amp;</span> <span class="pre">kubectl</span> <span class="pre">create</span> <span class="pre">-f</span> <span class="pre">trainer.yaml</span></code> to start the job on your kubernetes cluster (you must configure the <code class="docutils literal"><span class="pre">kubectl</span></code> client before this step).</li>
<li>Run <code class="docutils literal"><span class="pre">kubectl</span> <span class="pre">get</span> <span class="pre">po</span></code> to get running pods, and run <code class="docutils literal"><span class="pre">kubectl</span> <span class="pre">logs</span> <span class="pre">[podID]</span></code> to fetch the pod log of pservers and trainers.</li>
</ol>
<p>Check the logs for the distributed training progress and analyze the performance.</p>
</div>
<div class="section" id="enable-verbos-logs">
<span id="enable-verbos-logs"></span><h2>Enable Verbos Logs<a class="headerlink" href="#enable-verbos-logs" title="永久链接至标题">¶</a></h2>
<p>Edit <code class="docutils literal"><span class="pre">pserver.yaml</span></code> and <code class="docutils literal"><span class="pre">trainer.yaml</span></code> and add an environment variable <code class="docutils literal"><span class="pre">GLOG_v=3</span></code> and <code class="docutils literal"><span class="pre">GLOG_logtostderr=1</span></code> to see what happend in detail.</p>
</div>
</div>
</div>
<div class="articleComments">
</div>
</div>