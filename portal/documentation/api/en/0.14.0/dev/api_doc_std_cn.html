<div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
<div itemprop="articleBody">
<div class="section" id="api">
<span id="api"></span><h1>API注释撰写标准<a class="headerlink" href="#api" title="永久链接至标题">¶</a></h1>
<ul class="simple">
<li><a class="reference external" href="#API注释模块">API注释模块</a></li>
<li><a class="reference external" href="#格式及示例">格式及示例</a></li>
<li><a class="reference external" href="#完整示例">完整示例</a></li>
</ul>
<div class="section" id="api">
<span id="id1"></span><h2>API注释模块<a class="headerlink" href="#api" title="永久链接至标题">¶</a></h2>
<p>API文档须包含以下几个模块（排列顺序为文档撰写顺序）：</p>
<ul>
<li><p class="first">Python API Definition</p>
<p>API的代码定义。</p>
</li>
<li><p class="first">Function Description</p>
<p>API的功能描述。描述该API的含义、作用或对输入所做的操作，及参考文献和对应链接（如果有），必要时给出公式，并解释公式中关键变量的含义。</p>
</li>
<li><p class="first">Args Description</p>
<p>API参数介绍。按代码定义中的参数顺序逐个介绍，介绍内容包含数据类型、默认值（如果有）、含义等。</p>
</li>
<li><p class="first">Returns</p>
<p>API返回值介绍。介绍返回值含义，必要时给出对应的形状。若返回值为包含多个参数的tuple，则按顺序逐个介绍各参数。</p>
</li>
<li><p class="first">Raises（如果有）</p>
<p>可能抛出的异常或错误及可能的产生原因，当可能抛出多种异常或错误时应分条列出。</p>
</li>
<li><p class="first">Note（如果有）</p>
<p>注意事项。当有多条注意事项时，应分条列出。</p>
</li>
<li><p class="first">Examples</p>
<p>API的使用示例。</p>
</li>
</ul>
</div>
<div class="section" id="">
<span id="id2"></span><h2>格式及示例<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<p>API文档须使用reStructuredText格式撰写，该格式详情请参考<a class="reference external" href="http://sphinx-doc-zh.readthedocs.io/en/latest/rest.html">链接</a>。API文档各模块的内容格式及示例如下（以下以fc为例进行说明）：</p>
<ul>
<li><p class="first">Python API Definition</p>
<ul>
<li><p class="first">格式：</p>
<p>[Python API Definition]</p>
</li>
<li><p class="first">示例</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">fc</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span>
   <span class="n">size</span><span class="p">,</span>
   <span class="n">num_flatten_dims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
   <span class="n">param_attr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
   <span class="n">bias_attr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
   <span class="n">act</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
   <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
   <span class="n">main_program</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
   <span class="n">startup_program</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Function Description</p>
<ul>
<li><p class="first">格式</p>
<p>本模块应包含以下内容（排列顺序为文档撰写顺序）：</p>
<p>[Function Description]</p>
<p>[Formula]</p>
<p>[Symbols’ Descriptions if necessary]</p>
<p>[References if necessary]</p>
</li>
<li><p class="first">示例</p>
<p>[Function Description]</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">**</span><span class="n">Fully</span> <span class="n">Connected</span> <span class="n">Layer</span><span class="o">**</span>

<span class="n">The</span> <span class="n">fully</span> <span class="n">connected</span> <span class="n">layer</span> <span class="n">can</span> <span class="n">take</span> <span class="n">multiple</span> <span class="n">tensors</span> <span class="k">as</span> <span class="n">its</span> <span class="n">inputs</span><span class="o">.</span> <span class="n">It</span>
<span class="n">creates</span> <span class="n">a</span> <span class="n">variable</span> <span class="n">called</span> <span class="n">weights</span> <span class="k">for</span> <span class="n">each</span> <span class="nb">input</span> <span class="n">tensor</span><span class="p">,</span> <span class="n">which</span> <span class="n">represents</span>
<span class="n">a</span> <span class="n">fully</span> <span class="n">connected</span> <span class="n">weight</span> <span class="n">matrix</span> <span class="kn">from</span> <span class="nn">each</span> <span class="nb">input</span> <span class="n">unit</span> <span class="n">to</span> <span class="n">each</span> <span class="n">output</span> <span class="n">unit</span><span class="o">.</span>
<span class="n">The</span> <span class="n">fully</span> <span class="n">connected</span> <span class="n">layer</span> <span class="n">multiplies</span> <span class="n">each</span> <span class="nb">input</span> <span class="n">tensor</span> <span class="k">with</span> <span class="n">its</span> <span class="n">coresponding</span>
<span class="n">weight</span> <span class="n">to</span> <span class="n">produce</span> <span class="n">an</span> <span class="n">output</span> <span class="n">Tensor</span><span class="o">.</span> <span class="n">If</span> <span class="n">multiple</span> <span class="nb">input</span> <span class="n">tensors</span> <span class="n">are</span> <span class="n">given</span><span class="p">,</span>
<span class="n">the</span> <span class="n">results</span> <span class="n">of</span> <span class="n">multiple</span> <span class="n">multiplications</span> <span class="n">will</span> <span class="n">be</span> <span class="n">sumed</span> <span class="n">up</span><span class="o">.</span> <span class="n">If</span> <span class="n">bias_attr</span> <span class="ow">is</span>
<span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">a</span> <span class="n">bias</span> <span class="n">variable</span> <span class="n">will</span> <span class="n">be</span> <span class="n">created</span> <span class="ow">and</span> <span class="n">added</span> <span class="n">to</span> <span class="n">the</span> <span class="n">output</span><span class="o">.</span> <span class="n">Finally</span><span class="p">,</span>
<span class="k">if</span> <span class="n">activation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">it</span> <span class="n">will</span> <span class="n">be</span> <span class="n">applied</span> <span class="n">to</span> <span class="n">the</span> <span class="n">output</span> <span class="k">as</span> <span class="n">well</span><span class="o">.</span>
</pre></div>
</div>
<p>[Formula]</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">This</span> <span class="n">process</span> <span class="n">can</span> <span class="n">be</span> <span class="n">formulated</span> <span class="k">as</span> <span class="n">follows</span><span class="p">:</span>

<span class="o">..</span> <span class="n">math</span><span class="p">::</span>

     <span class="n">Out</span> <span class="o">=</span> <span class="n">Act</span><span class="p">({</span>\<span class="n">sum_</span><span class="p">{</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">}</span><span class="o">^</span><span class="p">{</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">}</span><span class="n">X_iW_i</span> <span class="o">+</span> <span class="n">b</span><span class="p">})</span>
</pre></div>
</div>
<p>[Symbols’ Descriptions if necessary]</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>In the above equation:

* :math:`N`: Number of the input.
* :math:`X_i`: The input tensor.
* :math:`W`: The weights created by this layer.
* :math:`b`: The bias parameter created by this layer (if needed).
* :math:`Act`: The activation function.
* :math:`Out`: The output tensor.
</pre></div>
</div>
<p>[References if necessary]</p>
<p>因fc没有必要列出的参考文献，故该内容省略。其他情况下需明确给出对应的参考文献和对应连接，以 layer_norm 为例：</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>Refer to `Layer Normalization &lt;https://arxiv.org/pdf/1607.06450v1.pdf&gt;`_ for more details.
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
<ul>
<li><p class="first">Args Description</p>
<ul>
<li><p class="first">格式</p>
<p>[Arg’s Name][(Data Type, Default Value)][Description]</p>
</li>
<li><p class="first">示例</p>
<p>fc的部分参数注释如下：</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Args</span><span class="p">:</span>
    <span class="nb">input</span> <span class="p">(</span><span class="n">Variable</span><span class="o">|</span><span class="nb">list</span> <span class="n">of</span> <span class="n">Variable</span><span class="p">):</span> <span class="n">The</span> <span class="nb">input</span> <span class="n">tensor</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">of</span> <span class="n">this</span> <span class="n">layer</span><span class="p">,</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">dimension</span> <span class="n">of</span>
        <span class="n">the</span> <span class="nb">input</span> <span class="n">tensor</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">is</span> <span class="n">at</span> <span class="n">least</span> <span class="mf">2.</span>
    <span class="n">param_attr</span> <span class="p">(</span><span class="n">ParamAttr</span><span class="o">|</span><span class="nb">list</span> <span class="n">of</span> <span class="n">ParamAttr</span><span class="p">,</span> <span class="n">default</span> <span class="kc">None</span><span class="p">):</span> <span class="n">The</span> <span class="n">parameter</span> <span class="n">attribute</span> <span class="k">for</span> <span class="n">learnable</span>
        <span class="n">parameters</span><span class="o">/</span><span class="n">weights</span> <span class="n">of</span> <span class="n">this</span> <span class="n">layer</span><span class="o">.</span>
    <span class="n">name</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span> <span class="kc">None</span><span class="p">):</span> <span class="n">The</span> <span class="n">name</span> <span class="n">of</span> <span class="n">this</span> <span class="n">layer</span><span class="o">.</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Returns</p>
<ul>
<li><p class="first">格式</p>
<p>[Name][Shape]</p>
</li>
<li><p class="first">示例</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Returns</span><span class="p">:</span>
    <span class="n">A</span> <span class="n">tensor</span> <span class="n">variable</span> <span class="n">storing</span> <span class="n">the</span> <span class="n">transformation</span> <span class="n">result</span><span class="o">.</span>
</pre></div>
</div>
<p>当返回值为包含多个参数的tuple时，应按顺序逐个介绍各参数，以dynamic_lstm为例：</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Returns</span><span class="p">:</span>
    <span class="n">A</span> <span class="nb">tuple</span> <span class="n">containing</span><span class="p">:</span>
      <span class="n">The</span> <span class="n">hidden</span> <span class="n">state</span> <span class="n">of</span> <span class="n">LSTM</span> <span class="n">whose</span> <span class="n">shape</span> <span class="ow">is</span> <span class="p">(</span><span class="n">T</span> <span class="n">X</span> <span class="n">D</span><span class="p">)</span><span class="o">.</span>
      <span class="n">The</span> <span class="n">cell</span> <span class="n">state</span> <span class="n">of</span> <span class="n">LSTM</span> <span class="n">whose</span> <span class="n">shape</span> <span class="ow">is</span> <span class="p">(</span><span class="n">T</span> <span class="n">X</span> <span class="n">D</span><span class="p">)</span><span class="o">.</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Raises</p>
<ul>
<li><p class="first">格式</p>
<p>[Exception Type][Condition]</p>
</li>
<li><p class="first">示例</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Raises</span><span class="p">:</span>
    <span class="ne">ValueError</span><span class="p">:</span> <span class="n">If</span> <span class="n">the</span> <span class="n">rank</span> <span class="n">of</span> <span class="n">the</span> <span class="nb">input</span> <span class="ow">is</span> <span class="n">less</span> <span class="n">than</span> <span class="mf">2.</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Note</p>
<ul>
<li><p class="first">格式</p>
<p>[Note]</p>
</li>
<li><p class="first">示例</p>
<p>fc没有注意事项，故该模块省略不写。如有注意事项应明确给出，当有多条注意事项，须分条列出，以scaled_dot_product_attention为例：</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Note</span><span class="p">:</span>
    <span class="mf">1.</span> <span class="n">When</span> <span class="n">num_heads</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">three</span> <span class="n">linear</span> <span class="n">projections</span> <span class="n">are</span> <span class="n">learned</span> <span class="n">respectively</span>
       <span class="n">to</span> <span class="nb">map</span> <span class="nb">input</span> <span class="n">queries</span><span class="p">,</span> <span class="n">keys</span> <span class="ow">and</span> <span class="n">values</span> <span class="n">into</span> <span class="n">queries</span><span class="s1">', keys'</span> <span class="ow">and</span> <span class="n">values</span><span class="s1">'.</span>
       <span class="n">queries</span><span class="s1">', keys'</span> <span class="ow">and</span> <span class="n">values</span><span class="s1">' have the same shapes with queries, keys</span>
       <span class="ow">and</span> <span class="n">values</span><span class="o">.</span>
    <span class="mf">2.</span> <span class="n">When</span> <span class="n">num_heads</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">scaled_dot_product_attention</span> <span class="n">has</span> <span class="n">no</span> <span class="n">learnable</span>
       <span class="n">parameters</span><span class="o">.</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Examples</p>
<ul>
<li><p class="first">格式</p>
<p>[Python Code Snipper]</p>
</li>
<li><p class="first">示例</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Examples</span><span class="p">:</span>
    <span class="o">..</span> <span class="n">code</span><span class="o">-</span><span class="n">block</span><span class="p">::</span> <span class="n">python</span>

      <span class="n">data</span> <span class="o">=</span> <span class="n">fluid</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"data"</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float32"</span><span class="p">)</span>
      <span class="n">fc</span> <span class="o">=</span> <span class="n">fluid</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">fc</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">act</span><span class="o">=</span><span class="s2">"tanh"</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="">
<span id="id3"></span><h2>完整示例<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<p>fc 的完整注释见<a class="reference external" href="dev/src/fc.py">示例</a>。</p>
</div>
</div>
</div>
<div class="articleComments">
</div>
</div>